# Default values for inmidst Helm chart
# Override per environment via -f values-production.yaml
#
# IMPORTANT: Override secrets in production via:
#   helm install inmidst ./infra/helm -f values-production.yaml
#   --set secrets.postgresPassword=<real-password>
#   --set secrets.jwtSecret=<real-secret>
# Or use external secret management (Vault, sealed-secrets, SOPS).

# --- Secrets (override in production!) ---
secrets:
  postgresPassword: changeme
  jwtSecret: changeme-jwt-secret
  redisPassword: ""
  # stripeSecretKey: ""
  # stripeWebhookSecret: ""

image:
  repository: ghcr.io/4444j99/inmidst
  tag: latest
  pullPolicy: IfNotPresent

# --- API Service ---
api:
  replicaCount: 2
  service:
    port: 3001
    type: ClusterIP
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  livenessProbe:
    httpGet:
      path: /health
      port: 3001
    initialDelaySeconds: 10
    periodSeconds: 15
    timeoutSeconds: 3
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /ready
      port: 3001
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  env:
    NODE_ENV: production
    PORT: "3001"

# --- Web (Next.js) ---
web:
  replicaCount: 2
  service:
    port: 3000
    type: ClusterIP
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  livenessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 15
    periodSeconds: 20
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 6
    targetCPUUtilizationPercentage: 70
  env:
    NODE_ENV: production

# --- Orchestrator (Worker) ---
orchestrator:
  replicaCount: 1
  service:
    port: 3002
    type: ClusterIP
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  livenessProbe:
    httpGet:
      path: /health
      port: 3002
    initialDelaySeconds: 10
    periodSeconds: 15
    timeoutSeconds: 3
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /health
      port: 3002
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 3
    failureThreshold: 3
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 4
    targetCPUUtilizationPercentage: 80
  env:
    NODE_ENV: production
    PORT: "3002"
    ORCH_WORKER_ENABLED: "true"
    ORCH_SCHEDULER_ENABLED: "true"

# --- Migrations ---
migrations:
  enabled: true
  env:
    REDIS_URL: redis://inmidst-redis:6379

# --- PostgreSQL ---
postgres:
  enabled: true
  image: pgvector/pgvector:pg15
  port: 5432
  username: inmidst
  # Password is managed via secrets.postgresPassword (see secrets.yaml template)
  database: midst_prod
  storage: 10Gi
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

# --- Redis ---
redis:
  enabled: true
  image: redis:7-alpine
  port: 6379
  storage: 2Gi
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 250m
      memory: 256Mi

# --- Backups ---
backup:
  schedule: "0 3 * * *"  # Daily at 3 AM UTC
  storage: 5Gi

# --- Ingress ---
ingress:
  enabled: false
  className: nginx
  annotations: {}
    # cert-manager.io/cluster-issuer: letsencrypt-prod
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: app.example.com
      paths:
        - path: /
          service: web
        - path: /api
          service: api
  tls: []
